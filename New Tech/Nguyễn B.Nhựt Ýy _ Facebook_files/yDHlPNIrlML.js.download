;/*FB_PKG_DELIM*/

__d("CometPhotoViewerImageSuspense",["Promise","PromiseAnnotate","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=(j||(j=d("react"))).c,l=j,m=document.body,n=typeof jest==="undefined"&&document!==void 0&&typeof document.createElement==="function";function o(a){return new(h||(h=b("Promise")))(function(b){if(!n||m==null)return b();var c=document.createElement("img");c.onload=c.onerror=b;c.src=a})}var p=new Map(),q=2e3,r={get:function(a){var b=p.get(a);if(b!=null){p["delete"](a);p.set(a,b);return b}},set:function(a,b){p["delete"](a);p.set(a,b);if(p.size>q){a=p.keys().next();a.done||p["delete"](a.value)}}};function s(a){if(a==null)return;var b=r.get(a);if(b!=null)if(b.pending===!0)throw b.promise;else return;else{b=o(a);(i||(i=d("PromiseAnnotate"))).setDisplayName(b,"SuspenseImage");var c={pending:!0,promise:b};b.then(function(){c.pending===!0&&(c.pending=!1)});r.set(a,c);throw b}}c=l.forwardRef(a);function a(a,b){var c=k(5),d;c[0]!==a?(d=babelHelpers["extends"]({},a),c[0]=a,c[1]=d):d=c[1];s(d.src);c[2]!==d||c[3]!==b?(a=l.jsx("img",babelHelpers["extends"]({},d,{ref:b})),c[2]=d,c[3]=b,c[4]=a):a=c[4];return a}e=c;g["default"]=e}),98);
__d("CometPhotoViewerInnerWrapper.react",["CometRouteRenderType","react","stylex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(i||(i=d("react"))).c,k=i,l={backgroundContainer:{alignItems:"x6s0dn4",display:"x78zum5",justifyContent:"xl56j7k",minHeight:"x1xoerdy",$$css:!0},backgroundContainerDialog:{height:"x1dr59a3",$$css:!0},backgroundContainerDialogWithFooter:{height:"x4uq5q4",$$css:!0},backgroundContainerTabs:{height:"xtp0wl1",$$css:!0},backgroundContainerTabsWithFooter:{height:"xossbfl",$$css:!0},image:{height:"xt7dq6l",maxWidth:"x193iq5w",width:"x14atkfc",$$css:!0},maxImageHeightDialog:{maxHeight:"x1bwycvy",$$css:!0},maxImageHeightDialogWithFooter:{maxHeight:"x4ju7c5",$$css:!0},maxImageHeightTabs:{maxHeight:"x85a59c",$$css:!0},maxImageHeightTabsWithFooter:{maxHeight:"x1wlxzsl",$$css:!0},passthroughImage:{backgroundPosition:"x1lvsgvq",backgroundRepeat:"xiy17q3",backgroundSize:"x1tbiz1a",height:"x5yr21d",width:"xh8yej3",$$css:!0},placeholderContainer:{width:"xh8yej3",$$css:!0}};function m(a,b){var e=j(6);a=a===void 0?!1:a;b=b===void 0?!1:b;var f=d("CometRouteRenderType").useIsPushView(),g=!a&&f&&l.backgroundContainerDialog,i=!a&&!f&&l.backgroundContainerTabs,k=a&&f&&l.backgroundContainerDialogWithFooter;a=a&&!f&&l.backgroundContainerTabsWithFooter;f=b&&l.placeholderContainer;e[0]!==g||e[1]!==i||e[2]!==k||e[3]!==a||e[4]!==f?(b=(h||(h=c("stylex")))(l.backgroundContainer,g,i,k,a,f),e[0]=g,e[1]=i,e[2]=k,e[3]=a,e[4]=f,e[5]=b):b=e[5];return b}function n(a,b){var e=j(7),f=d("CometRouteRenderType").useIsPushView(),g=!a&&f&&l.maxImageHeightDialog,i=!a&&!f&&l.maxImageHeightTabs,k=a&&f&&l.maxImageHeightDialogWithFooter;a=a&&!f&&l.maxImageHeightTabsWithFooter;f=b&&l.passthroughImage;b=!b&&l.image;var m;e[0]!==g||e[1]!==i||e[2]!==k||e[3]!==a||e[4]!==f||e[5]!==b?(m=(h||(h=c("stylex")))(g,i,k,a,f,b),e[0]=g,e[1]=i,e[2]=k,e[3]=a,e[4]=f,e[5]=b,e[6]=m):m=e[6];return m}function o(a,b){var c=j(7),e=d("CometRouteRenderType").useIsPushView(),f=!a&&e&&l.maxImageHeightDialog,g=!a&&!e&&l.maxImageHeightTabs,h=a&&e&&l.maxImageHeightDialogWithFooter;a=a&&!e&&l.maxImageHeightTabsWithFooter;e=b&&l.passthroughImage;b=!b&&l.image;var i;c[0]!==f||c[1]!==g||c[2]!==h||c[3]!==a||c[4]!==e||c[5]!==b?(i=[f,g,h,a,e,b],c[0]=f,c[1]=g,c[2]=h,c[3]=a,c[4]=e,c[5]=b,c[6]=i):i=c[6];return i}e=k.forwardRef(a);function a(a,b){var c=j(9),d=a.height,e=a.imageUri,f=a.showPlaceholderImage,g=a.width;a=a.withFooter;f=f===void 0?!0:f;a=a===void 0?!1:a;a=n(a,!0);var h=m(!1,!0),i;c[0]!==e||c[1]!==f||c[2]!==d||c[3]!==g||c[4]!==a?(i=e!=null&&f&&k.jsx("div",{className:"x6s0dn4 x78zum5 xl56j7k xmz0i5r x1n2onr6 x5yr21d xh8yej3",children:k.jsx("div",{className:a,style:d!=null&&g!=null?{backgroundImage:"url("+e+")",maxHeight:d,maxWidth:g}:{backgroundImage:"url("+e+")"}},e)}),c[0]=e,c[1]=f,c[2]=d,c[3]=g,c[4]=a,c[5]=i):i=c[5];if(c[6]!==h||c[7]!==i){f=k.jsx("div",{className:h,ref:(e=b)!=null?e:null,children:i});c[6]=h;c[7]=i;c[8]=f}else f=c[8];return f}f=k.forwardRef(b);function b(a,b){var c=j(9),d=a.imageComponent,e=a.imageComponentWithXStyle;a=a.withFooter;a=a===void 0?!1:a;var f=n(a,!1);a=o(a,!1);var g;c[0]===Symbol["for"]("react.memo_cache_sentinel")?(g="x6s0dn4 x78zum5 xl56j7k xmz0i5r x1n2onr6",c[0]=g):g=c[0];var h;c[1]!==d||c[2]!==f||c[3]!==e||c[4]!==a?(h=d!=null?d(f):e!=null?e(a):null,c[1]=d,c[2]=f,c[3]=e,c[4]=a,c[5]=h):h=c[5];c[6]!==b||c[7]!==h?(d=k.jsx("div",{className:g,ref:b,children:h}),c[6]=b,c[7]=h,c[8]=d):d=c[8];return d}a=f;b=e;g.useCometPhotoViewerContainerStyles=m;g.CometPhotoViewerImageWrapper=a;g.CometPhotoViewerPlaceholderWrapper=b}),98);
__d("MWChatDeleteMessageEventEmitter",["BaseEventEmitter"],(function(a,b,c,d,e,f,g){"use strict";var h="deleteMessage",i=new(c("BaseEventEmitter"))();function a(a){i.emit(h,a)}function b(a){var b=i.addListener(h,a);return function(){return b.remove()}}g.emit=a;g.subscribe=b}),98);
__d("MWChatMediaData",[],(function(a,b,c,d,e,f){"use strict";var g=function(a){return a==null||a.__typename!=="MessageVideo"||a.sdUrl==null||a.image_thumb==null||a.image_thumb.uri==null||a.image_thumb.width==null||a.image_thumb.height==null||a.original_dimensions==null||a.original_dimensions.x==null||a.original_dimensions.y==null?null:{hdUrl:a.hdUrl,imageThumb:{height:a.image_thumb.height,uri:a.image_thumb.uri,width:a.image_thumb.width},legacyAttachmentID:a.legacy_attachment_id,originalDimensions:{x:a.original_dimensions.x,y:a.original_dimensions.y},sdUrl:a.sdUrl}},h=function(a){return a==null||a.__typename!=="MessageImage"||a.image==null||a.image.uri==null||a.image.width==null||a.image.height==null||a.image_thumb==null||a.image_thumb.uri==null||a.image_thumb.width==null||a.image_thumb.height==null?null:{blurredImageUri:a.blurred_image_uri,image:{downloadableUri:a.image.downloadable_uri,height:a.image.height,uri:a.image.uri,width:a.image.width},imageThumb:{height:a.image_thumb.height,uri:a.image_thumb.uri,width:a.image_thumb.width},legacyAttachmentID:a.legacy_attachment_id}},i=function(a){return a==null||a.__typename!=="MessageAnimatedImage"||a.image==null||a.image.uri==null||a.image.width==null||a.image.height==null||a.image_thumb==null||a.image_thumb.uri==null||a.image_thumb.width==null||a.image_thumb.height==null?null:{blurredImageUri:null,image:{downloadableUri:a.image.downloadable_uri,height:a.image.height,uri:a.image.uri,width:a.image.width},imageThumb:{height:a.image_thumb.height,uri:a.image_thumb.uri,width:a.image_thumb.width},legacyAttachmentID:a.legacy_attachment_id}};a=function(a){return a.reduce(function(a,b){if(b==null||b.node==null||b.node.id==null||b.node.message_id==null||b.node.blob_attachments==null||b.cursor==null)return a;var c=b.node,d=c.blob_attachments,e=c.id,f=c.message_id,j=c.timestamp_precise,k=b.cursor;c=d.map(function(a){if(a.__typename==="MessageImage"){var b=h(a);return b==null?null:{__typename:"MessageImage",attachment:b,cursor:k,messageID:f,nodeID:e,timestamp:j}}else if(a.__typename==="MessageVideo"){b=g(a);return b==null?null:{__typename:"MessageVideo",attachment:b,cursor:k,messageID:f,nodeID:e,timestamp:j}}else if(a.__typename==="MessageAnimatedImage"){b=i(a);return b==null?null:{__typename:"MessageAnimatedImage",attachment:b,cursor:k,messageID:f,nodeID:e,timestamp:j}}else return null}).filter(Boolean);return a.concat(c)},[]).filter(Boolean)};f.normalizeMessages=a}),66);
__d("MWChatMediaReducer",[],(function(a,b,c,d,e,f){"use strict";a={curIdx:0,hasNextPage:!1,hasPrevPage:!1,initialCursor:null,isFetchingNextPage:!1,isFetchingPrevPage:!1,mediaList:[]};b=function(a,b){switch(b.type){case"initialize":return babelHelpers["extends"]({},a,{curIdx:b.curIdx,initialCursor:b.initialCursor,mediaList:b.mediaList});case"startFetchingNextPage":return babelHelpers["extends"]({},a,{isFetchingNextPage:!0});case"startFetchingPrevPage":return babelHelpers["extends"]({},a,{isFetchingPrevPage:!0});case"prevPageReceived":return babelHelpers["extends"]({},a,{curIdx:a.curIdx+b.medias.length,hasPrevPage:b.hasPrevPage,isFetchingPrevPage:!1,mediaList:b.medias.concat(a.mediaList)});case"nextPageReceived":return babelHelpers["extends"]({},a,{hasNextPage:b.hasNextPage,isFetchingNextPage:!1,mediaList:a.mediaList.concat(b.medias)});case"messageDeleted":return babelHelpers["extends"]({},a,{curIdx:Math.min(Math.max(b.curIdx,0),a.mediaList.length-1),mediaList:b.mediaList});case"viewMediaAtIndex":return babelHelpers["extends"]({},a,{curIdx:Math.min(Math.max(b.curIdx,0),a.mediaList.length-1)});default:return a}};f.initialState=a;f.reducer=b}),66);
__d("MWChatMediaRootQuery.graphql",["MWChatMediaRootQuery_facebookRelayOperation","relay-runtime"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"after"},c={defaultValue:null,kind:"LocalArgument",name:"before"},d={defaultValue:null,kind:"LocalArgument",name:"first"},e={defaultValue:null,kind:"LocalArgument",name:"last"},f={defaultValue:null,kind:"LocalArgument",name:"messageID"},g={defaultValue:null,kind:"LocalArgument",name:"scale"},h={defaultValue:null,kind:"LocalArgument",name:"threadID"},i=[{kind:"Variable",name:"id",variableName:"threadID"}],j={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"folder",storageKey:null},l=[{kind:"Variable",name:"after",variableName:"after"},{kind:"Literal",name:"ascending",value:!0},{kind:"Variable",name:"before",variableName:"before"},{kind:"Variable",name:"first",variableName:"first"},{kind:"Variable",name:"last",variableName:"last"},{kind:"Variable",name:"message_id",variableName:"messageID"},{kind:"Literal",name:"message_shared_media_type",value:"PHOTO_VIDEO_AND_GIF"}],m={alias:null,args:null,kind:"ScalarField",name:"message_id",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"timestamp_precise",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"legacy_attachment_id",storageKey:null},q={alias:null,args:null,kind:"ScalarField",name:"uri",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"width",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"height",storageKey:null},t=[q,r,s,{alias:null,args:null,kind:"ScalarField",name:"downloadable_uri",storageKey:null}];q={alias:"image_thumb",args:[{kind:"Literal",name:"height",value:250},{kind:"Literal",name:"width",value:250}],concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:[q,r,s],storageKey:"image(height:250,width:250)"};r={kind:"InlineFragment",selections:[p,{alias:null,args:null,kind:"ScalarField",name:"blurred_image_uri",storageKey:null},{alias:null,args:[{kind:"Literal",name:"height",value:2048},{kind:"Variable",name:"scale",variableName:"scale"},{kind:"Literal",name:"width",value:2048}],concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:t,storageKey:null},q],type:"MessageImage",abstractKey:null};s={kind:"InlineFragment",selections:[p,{alias:"sdUrl",args:[{kind:"Literal",name:"quality",value:"SD"}],kind:"ScalarField",name:"playable_url",storageKey:'playable_url(quality:"SD")'},{alias:"hdUrl",args:[{kind:"Literal",name:"quality",value:"HD"}],kind:"ScalarField",name:"playable_url",storageKey:'playable_url(quality:"HD")'},q,{alias:null,args:null,concreteType:"Vect2",kind:"LinkedField",name:"original_dimensions",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"x",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"y",storageKey:null}],storageKey:null}],type:"MessageVideo",abstractKey:null};p={kind:"InlineFragment",selections:[p,{alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:t,storageKey:null},q,{alias:null,args:null,kind:"ScalarField",name:"animated_image_caption",storageKey:null}],type:"MessageAnimatedImage",abstractKey:null};t={alias:null,args:null,kind:"ScalarField",name:"cursor",storageKey:null};q={alias:null,args:null,concreteType:"PageInfo",kind:"LinkedField",name:"page_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_next_page",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_previous_page",storageKey:null}],storageKey:null};return{fragment:{argumentDefinitions:[a,c,d,e,f,g,h],kind:"Fragment",metadata:null,name:"MWChatMediaRootQuery",selections:[{alias:null,args:i,concreteType:"MessageThread",kind:"LinkedField",name:"message_thread",plural:!1,selections:[j,k,{alias:null,args:l,concreteType:"MessagesWithAttachmentsOfThreadConnection",kind:"LinkedField",name:"messages_with_attachments",plural:!1,selections:[{alias:null,args:null,concreteType:"MessagesWithAttachmentsOfThreadEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[{kind:"InlineFragment",selections:[m,j,n,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"blob_attachments",plural:!0,selections:[o,r,s,p],storageKey:null}],type:"UserMessage",abstractKey:null}],storageKey:null},t],storageKey:null},q],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[h,f,a,d,c,e,g],kind:"Operation",name:"MWChatMediaRootQuery",selections:[{alias:null,args:i,concreteType:"MessageThread",kind:"LinkedField",name:"message_thread",plural:!1,selections:[j,k,{alias:null,args:l,concreteType:"MessagesWithAttachmentsOfThreadConnection",kind:"LinkedField",name:"messages_with_attachments",plural:!1,selections:[{alias:null,args:null,concreteType:"MessagesWithAttachmentsOfThreadEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[o,j,{kind:"InlineFragment",selections:[m,n,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"blob_attachments",plural:!0,selections:[o,r,s,p,{kind:"InlineFragment",selections:[j],type:"Node",abstractKey:"__isNode"}],storageKey:null}],type:"UserMessage",abstractKey:null}],storageKey:null},t],storageKey:null},q],storageKey:null}],storageKey:null}]},params:{id:b("MWChatMediaRootQuery_facebookRelayOperation"),metadata:{},name:"MWChatMediaRootQuery",operationKind:"query",text:null}}}();b("relay-runtime").PreloadableQueryRegistry.set(a.params.id,a);e.exports=a}),null);
__d("MWChatMediaUtil",["ExecutionEnvironment"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a){if(!(h||(h=c("ExecutionEnvironment"))).canUseDOM)return;a.forEach(function(a){if(typeof a==="string"){var b=new Image();b.src=a}})};g.prefetchImages=a}),98);
__d("MWChatMediaViewerImage.react",["fbt","CometHero.react","CometPageletWithDiv.react","CometPhotoViewerImageSuspense","CometPhotoViewerInnerWrapper.react","MWXPressable.react","react","useMWMediaViewerOpenQPLLogger","useSinglePartialViewImpression"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));b=i;b.useCallback;var k=b.useState,l=b.c,m=h._("__JHASH__SUN00vbyQRp__JHASH__");function a(a){var b=l(21),e=a.blurredImageURI,f=a.imageURI,g=a.origHeight,i=a.origSrc;a=a.origWidth;var n=k(!1),o=n[0],p=n[1];n=d("useMWMediaViewerOpenQPLLogger").useMWMediaViewerOpenQPLLogger();var q=n.endSuccess;b[0]!==q?(n=function(){q()},b[0]=q,b[1]=n):n=b[1];n=n;var r;b[2]!==n?(r={onImpressionStart:n},b[2]=n,b[3]=r):r=b[3];n=c("useSinglePartialViewImpression")(r);r=d("CometPhotoViewerInnerWrapper.react").useCometPhotoViewerContainerStyles(!0);var s;b[4]!==i||b[5]!==a||b[6]!==g?(s=i!=null?j.jsx(d("CometPhotoViewerInnerWrapper.react").CometPhotoViewerPlaceholderWrapper,{height:g,imageUri:i,showPlaceholderImage:i!=null&&a!=null&&g!=null,width:a,withFooter:!0}):null,b[4]=i,b[5]=a,b[6]=g,b[7]=s):s=b[7];b[8]===Symbol["for"]("react.memo_cache_sentinel")?(i=j.jsx(c("CometHero.react"),{description:"MWChatMediaViewerImage"}),b[8]=i):i=b[8];b[9]!==e||b[10]!==o||b[11]!==f?(a=e==null||o?j.jsx(d("CometPhotoViewerInnerWrapper.react").CometPhotoViewerImageWrapper,{imageComponent:function(a){return j.jsx(c("CometPhotoViewerImageSuspense"),{alt:m,className:a,src:f},f)},withFooter:!0}):j.jsx(c("MWXPressable.react"),{display:"inline",label:h._("__JHASH__jjpvSNJ1g5C__JHASH__"),onPress:function(){return p(!0)},children:j.jsx(d("CometPhotoViewerInnerWrapper.react").CometPhotoViewerImageWrapper,{imageComponent:function(a){return j.jsx(c("CometPhotoViewerImageSuspense"),{alt:m,className:a,src:e},e)},withFooter:!0})}),b[9]=e,b[10]=o,b[11]=f,b[12]=a):a=b[12];b[13]!==r||b[14]!==s||b[15]!==f||b[16]!==a?(g=j.jsxs(d("CometPageletWithDiv.react").Placeholder,{className:r,fallback:s,name:"MessengerMediaViewerPhoto",pageletType:"media",children:[i,a]},f),b[13]=r,b[14]=s,b[15]=f,b[16]=a,b[17]=g):g=b[17];b[18]!==n||b[19]!==g?(o=j.jsx("div",{"data-testid":void 0,ref:n,children:g}),b[18]=n,b[19]=g,b[20]=o):o=b[20];return o}g["default"]=a}),226);
__d("MWChatMediaViewerStage.react",["fbt","CometBlurredBackgroundImage.react","CometKeys","CometMediaViewerFilmstrip.react","CurrentEnvironment","MWChatMediaViewerNavigationTapTarget.react","MWXLink.react","MessengerBlurpleLogoSvg.react","UNTRANSLATED_STRING_FIXME","XMessengerDotComCometRootControllerRouteBuilder","deferredLoadComponent","gkx","react","requireDeferred","stylex","useCometRouterDispatcher","useDebouncedComet","useIsReadOnlyFeatureLimitedWithThreadType","useLayerKeyCommands","useLayoutEffect_SAFE_FOR_SSR"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react"));b=j;b.useMemo;var l=b.useRef,m=b.useState,n=b.c,o=c("deferredLoadComponent")(c("requireDeferred")("MWChatMediaViewerControls.react").__setRef("MWChatMediaViewerStage.react")),p={footer:{maxWidth:"x193iq5w",overflowX:"x6ikm8r",overflowY:"x10wlt62",$$css:!0},headerContainer:{alignItems:"x6s0dn4",display:"x78zum5",height:"x1s65kcs",end:"xbruw4w",position:"x10l6tqk",zIndex:"x1vjfegm",$$css:!0},messengerDotComHeaderContainerHeight:{height:"xnnlda6",end:"xds687c",$$css:!0},root:{alignItems:"x6s0dn4",backgroundColor:"xal61yo",display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",height:"x5yr21d",minWidth:"x17upfok",position:"x1n2onr6",userSelect:"x87ps6o",":focus_outline":"x1uvtmcs",$$css:!0},rootFullHeight:{height:"x1dr59a3",overflowX:"x6ikm8r",overflowY:"x10wlt62",$$css:!0},scrollableFooter:{zIndex:"x1vjfegm",$$css:!0},workplaceHeaderContainer:{height:"xng8ra",end:"xlr8s2x",zIndex:"xhtitgo",$$css:!0},workroomsHeaderContainer:{height:"xng8ra",end:"xlr8s2x",zIndex:"xhtitgo",$$css:!0}},q=2e3,r=c("gkx")("22681");function a(a){var b=n(75),d=a.activeIndex,e=a.attachmentID,f=a.backgroundSrc,g=a.children,j=a.disableNextButton,t=a.disablePrevButton,u=a.downloadLink,v=a.hideNextButton,w=a.hidePrevButton,x=a.isForwardEnabledForThread,y=a.messageID,z=a.setActiveIndex,A=a.showMessengerLink,B=c("CurrentEnvironment").messengerdotcom,C=c("gkx")("20836"),D=c("gkx")("22805"),E=c("useIsReadOnlyFeatureLimitedWithThreadType")(null);E=!E&&x&&(!C||!c("gkx")("4888"));b[0]===Symbol["for"]("react.memo_cache_sentinel")?(x=h._("__JHASH__LwpPfoJWBJ-__JHASH__"),b[0]=x):x=b[0];x=x;var F;b[1]===Symbol["for"]("react.memo_cache_sentinel")?(F=h._("__JHASH__37s-bUHecpV__JHASH__"),b[1]=F):F=b[1];F=F;var G=l(!0),H=m(!1),I=H[0],J=H[1],K=l(null),L=c("useCometRouterDispatcher")();H=function(){return N.isPending()?P():N()};var M;b[2]===Symbol["for"]("react.memo_cache_sentinel")?(M={leading:!0,wait:q},b[2]=M):M=b[2];var N=c("useDebouncedComet")(function(){J(!1),P()},M),O;b[3]===Symbol["for"]("react.memo_cache_sentinel")?(M=function(){J(!0),G.current=!1},O={leading:!1,wait:q},b[3]=M,b[4]=O):(M=b[3],O=b[4]);var P=c("useDebouncedComet")(M,O);M=P;b[5]!==M?(O=function(){P(),K.current&&G.current&&K.current.focus()},b[5]=M,b[6]=O):O=b[6];c("useLayoutEffect_SAFE_FOR_SSR")(O);b[7]!==L?(M=function(){L!=null&&L.popPushView()},b[7]=L,b[8]=M):M=b[8];O=M;if(b[9]!==w||b[10]!==t||b[11]!==z||b[12]!==a.activeIndex||b[13]!==v||b[14]!==j){M=[];if(!w&&!t){var Q;b[16]===Symbol["for"]("react.memo_cache_sentinel")?(Q={key:c("CometKeys").LEFT},b[16]=Q):Q=b[16];b[17]!==z||b[18]!==a.activeIndex?(Q={command:Q,description:x,handler:function(){return z(a.activeIndex-1)}},b[17]=z,b[18]=a.activeIndex,b[19]=Q):Q=b[19];M.push(Q)}if(!v&&!j){b[20]===Symbol["for"]("react.memo_cache_sentinel")?(Q={key:c("CometKeys").RIGHT},b[20]=Q):Q=b[20];b[21]!==z||b[22]!==a.activeIndex?(Q={command:Q,description:F,handler:function(){return z(a.activeIndex+1)}},b[21]=z,b[22]=a.activeIndex,b[23]=Q):Q=b[23];M.push(Q)}b[9]=w;b[10]=t;b[11]=z;b[12]=a.activeIndex;b[13]=v;b[14]=j;b[15]=M}else M=b[15];Q=M;t=Q;j=w||I;b[24]!==z||b[25]!==d?(M=function(){return z(d-1)},b[24]=z,b[25]=d,b[26]=M):M=b[26];b[27]!==j||b[28]!==M?(Q=k.jsx(c("MWChatMediaViewerNavigationTapTarget.react"),{direction:"previous",invisible:j,label:x,onClick:M,testid:void 0,trackingNode:143}),b[27]=j,b[28]=M,b[29]=Q):Q=b[29];w=Q;x=v||I;b[30]!==z||b[31]!==d?(j=function(){return z(d+1)},b[30]=z,b[31]=d,b[32]=j):j=b[32];b[33]!==x||b[34]!==j?(M=k.jsx(c("MWChatMediaViewerNavigationTapTarget.react"),{direction:"next",invisible:x,label:F,onClick:j,testid:void 0,trackingNode:142}),b[33]=x,b[34]=j,b[35]=M):M=b[35];Q=M;v=c("gkx")("1775");c("useLayerKeyCommands")(t);b[36]===Symbol["for"]("react.memo_cache_sentinel")?(I=(i||(i=c("stylex")))([p.root,v&&p.rootFullHeight]),b[36]=I):I=b[36];b[37]!==A?(F=A&&k.jsx("div",{className:"x16q8cke x10l6tqk xomnu4r x1n327nk",children:k.jsx(c("MWXLink.react"),{"aria-label":c("UNTRANSLATED_STRING_FIXME")("Messenger"),href:c("XMessengerDotComCometRootControllerRouteBuilder").buildURL({}),children:k.jsx(c("MessengerBlurpleLogoSvg.react"),{height:"40",width:"40"})})}),b[37]=A,b[38]=F):F=b[38];b[39]===Symbol["for"]("react.memo_cache_sentinel")?(x=k.jsx("div",{className:"x1f90px3 x1ffmiix x10l6tqk xh8yej3 x1vjfegm"}),j="x1ey2m1c xds687c x17qophe xuzhngd x10l6tqk x13vifvy",b[39]=x,b[40]=j):(x=b[39],j=b[40]);b[41]!==f?(M=f!=null?k.jsx(c("CometBlurredBackgroundImage.react"),{src:f}):null,b[41]=f,b[42]=M):M=b[42];b[43]!==M?(t=k.jsx("div",{className:j,children:M}),b[43]=M,b[44]=t):t=b[44];b[45]===Symbol["for"]("react.memo_cache_sentinel")?(A="x9f619 x78zum5 x1iyjqo2 x5yr21d xl56j7k x6ikm8r x10wlt62 x1n2onr6 xh8yej3 xvj1nn1 x1nd34w2",b[45]=A):A=b[45];b[46]!==e||b[47]!==y||b[48]!==E||b[49]!==u?(f=e!=null&&y!=null?k.jsx("div",{className:(i||(i=c("stylex")))(p.headerContainer,B&&p.messengerDotComHeaderContainerHeight,C&&p.workplaceHeaderContainer,D&&p.workroomsHeaderContainer),children:k.jsx(o,{attachmentID:e,canForward:E,downloadLink:u,messageID:y})}):null,b[46]=e,b[47]=y,b[48]=E,b[49]=u,b[50]=f):f=b[50];b[51]===Symbol["for"]("react.memo_cache_sentinel")?(j="x6s0dn4 x1ey2m1c x78zum5 xds687c x17qophe x1qughib x10l6tqk x13vifvy x1ja2u2z",b[51]=j):j=b[51];b[52]!==O?(M=!r&&k.jsx("div",{"aria-hidden":!0,className:"x1ey2m1c x9f619 xds687c x17qophe x10l6tqk x13vifvy","data-testid":void 0,onClick:O}),b[52]=O,b[53]=M):M=b[53];b[54]!==M||b[55]!==w||b[56]!==Q?(B=k.jsxs("div",{className:j,children:[M,w,Q]}),b[54]=M,b[55]=w,b[56]=Q,b[57]=B):B=b[57];b[58]!==f||b[59]!==B||b[60]!==g?(C=k.jsxs("div",{className:A,children:[f,B,g]}),b[58]=f,b[59]=B,b[60]=g,b[61]=C):C=b[61];b[62]===Symbol["for"]("react.memo_cache_sentinel")?(D=(i||(i=c("stylex")))([p.footer,v&&p.scrollableFooter]),b[62]=D):D=b[62];b[63]!==a.thumbnails?(e=a.thumbnails.map(s),b[63]=a.thumbnails,b[64]=e):e=b[64];b[65]!==d||b[66]!==e||b[67]!==z?(y=k.jsx("div",{className:D,children:k.jsx(c("CometMediaViewerFilmstrip.react"),{activeIndex:d,images:e,onSetImage:z})}),b[65]=d,b[66]=e,b[67]=z,b[68]=y):y=b[68];b[69]!==H||b[70]!==F||b[71]!==t||b[72]!==C||b[73]!==y?(E=k.jsxs("div",{className:I,"data-testid":void 0,onMouseMove:H,ref:K,tabIndex:"0",children:[F,x,t,C,y]}),b[69]=H,b[70]=F,b[71]=t,b[72]=C,b[73]=y,b[74]=E):E=b[74];return E}function s(a){return babelHelpers["extends"]({},a,{mediaType:"image"})}g["default"]=a}),226);
__d("MWChatMediaViewerVideo.react",["CometRouteRenderType","MWChatVideoPlayer.react","MWVideoPlayerControllerContext.react","gkx","react","stylex","useMWMediaViewerOpenQPLLogger","useRoutePassthroughProps","useSinglePartialViewImpression"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||(i=d("react"));b=i;var k=b.useCallback,l=b.useContext,m=b.useEffect;b.useMemo;var n=b.useRef,o=b.c,p={videoContainer:{alignItems:"x6s0dn4",display:"x78zum5",flexGrow:"x1iyjqo2",justifyContent:"xl56j7k",minHeight:"x1xoerdy",width:"xh8yej3",$$css:!0},videoContainerDialog:{height:"x4uq5q4",$$css:!0},videoContainerTabs:{height:"x1ch8t6n",$$css:!0}};function q(a){var b=a.fbid,e=a.hdSrc,f=a.originalHeight,g=a.originalWidth;a=a.sdSrc;var i=d("CometRouteRenderType").useIsPushView(),o=c("useRoutePassthroughProps")(),q=(o==null?void 0:o.startTimestamp)!=null?Number(o.startTimestamp):void 0;o=(o==null?void 0:o.volumeSetting)!=null?Number(o.volumeSetting):void 0;var r=n(!1),s=l(c("MWVideoPlayerControllerContext.react")),t=s.ref.current;m(function(){t!==null&&!r.current&&(t.setMuted(!1,"product_initiated"),r.current=!0)},[t,r]);s=d("useMWMediaViewerOpenQPLLogger").useMWMediaViewerOpenQPLLogger();var u=s.endSuccess;s=k(function(){u()},[u]);s=c("useSinglePartialViewImpression")({onImpressionStart:s});return j.jsx("div",{className:(h||(h=c("stylex")))(p.videoContainer,i&&p.videoContainerDialog,!i&&p.videoContainerTabs),ref:s,children:j.jsx(c("MWChatVideoPlayer.react"),{controls:c("gkx")("5808")?"mwchat":"default",fbid:b,hdSrc:e,initialForceHD:!0,isMediaViewer:!0,mediaRenderQpl:null,originalHeight:f,originalWidth:g,sdSrc:a,shouldForcePauseOnClick:!1,startTimestamp:q,volumeSetting:o})})}q.displayName=q.name+" [from "+f.id+"]";function a(a){var b=o(3),d=n(null);b[0]===Symbol["for"]("react.memo_cache_sentinel")?(d={ref:d},b[0]=d):d=b[0];d=d;d=d;b[1]!==a?(d=j.jsx(c("MWVideoPlayerControllerContext.react").Provider,{value:d,children:j.jsx(q,babelHelpers["extends"]({},a))}),b[1]=a,b[2]=d):d=b[2];return d}g["default"]=a}),98);
__d("MWChatMediaRoot.react",["fbt","CometContentNotAvailable.react","CometErrorBoundary.react","CometErrorRoot.react","CometRelay","CometRouteParams","CometRouterPushViewStackContext","I64","LSMessagingThreadTypeUtil","MAWThreadCutover","MWChatDeleteMessageEventEmitter","MWChatMediaData","MWChatMediaReducer","MWChatMediaRootQuery.graphql","MWChatMediaUtil","MWChatMediaViewerImage.react","MWChatMediaViewerStage.react","MWChatMediaViewerVideo.react","MWChatMessageId","MWLSThread","Promise","ReQL","ReQLSuspense","WebPixelRatio","deferredLoadComponent","gkx","promiseDone","react","requireDeferred","useIsMountedRef","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l,m,n=m||(m=d("react"));e=m;var o=e.useCallback,p=e.useContext,q=e.useEffect,r=e.useReducer,s=e.useState,t=e.c,u=c("deferredLoadComponent")(c("requireDeferred")("MWV2MediaViewerThreadCutoverWrapper.react").__setRef("MWChatMediaRoot.react")),v=c("deferredLoadComponent")(c("requireDeferred")("MWV2MediaViewerContent.react").__setRef("MWChatMediaRoot.react")),w=20,x=i!==void 0?i:i=b("MWChatMediaRootQuery.graphql");function y(a){var e,f=a.props;a=a.queries;var g=d("CometRelay").useRelayEnvironment(),i=d("CometRouteParams").useRouteParams();f.manualRouteParams!=null&&(i=f.manualRouteParams);var j=p(c("CometRouterPushViewStackContext"))||[];j=j.length===0&&f.routeProps.showMessengerLink;f=s(null);var m=f[0],t=f[1];f=r(d("MWChatMediaReducer").reducer,d("MWChatMediaReducer").initialState);var u=f[0],v=u.curIdx,y=u.hasNextPage,z=u.hasPrevPage,A=u.initialCursor,B=u.isFetchingNextPage,C=u.isFetchingPrevPage,D=u.mediaList,E=f[1],F=c("useIsMountedRef")(),G=d("CometRelay").usePreloadedQuery(x,a.messengerMediaRootQueryReference);if(m!==null)throw m;q(function(){var a;a=G==null?void 0:(a=G.message_thread)==null?void 0:(a=a.messages_with_attachments)==null?void 0:(a=a.edges[0])==null?void 0:a.cursor;if(a!=null&&A===null){var b;b=G==null?void 0:(b=G.message_thread)==null?void 0:(b=b.messages_with_attachments)==null?void 0:b.edges;if(b!=null){b=d("MWChatMediaData").normalizeMessages(b);var c=0;i.attachment_id!=null&&(c=b.findIndex(function(a){return a.attachment.legacyAttachmentID===i.attachment_id}));E({curIdx:c,initialCursor:a,mediaList:b,type:"initialize"})}}},[A,G,i.attachment_id]);var H=G==null?void 0:(u=G.message_thread)==null?void 0:u.id;a=G==null?void 0:(f=G.message_thread)==null?void 0:f.folder;q(function(){return d("MWChatDeleteMessageEventEmitter").subscribe(function(a){var b=v,c=D.filter(function(c,d){c=c.messageID===a;c&&(d<=v&&v>0&&b--);return!c});c.length!==D.length&&(H!=null&&g.commitUpdate(function(a){return(a=a.get(H))==null?void 0:a.invalidateRecord()}));E({curIdx:b,mediaList:c,type:"messageDeleted"})})},[g,H,v,D]);var I=o(function(a){E({type:"startFetchingPrevPage"});if(typeof i.thread_id!=="string")return(k||(k=b("Promise"))).resolve();var c=i;c=c.thread_id;return d("CometRelay").fetchQuery(g,x,{before:a,last:w,scale:d("WebPixelRatio").get(),threadID:c}).toPromise().then(function(a){var b;if(!F.current)return;a=a==null?void 0:(a=a.message_thread)==null?void 0:a.messages_with_attachments;b=d("MWChatMediaData").normalizeMessages((b=a==null?void 0:a.edges)!=null?b:[]);if(b.length>0){E({hasPrevPage:(a=a==null?void 0:(a=a.page_info)==null?void 0:a.has_previous_page)!=null?a:!1,medias:b,type:"prevPageReceived"})}})["catch"](function(a){if(!F.current)return;t(a)})},[g,F,i]),J=o(function(a){E({type:"startFetchingNextPage"});if(typeof i.thread_id!=="string")return(k||(k=b("Promise"))).resolve();var c=i;c=c.thread_id;return d("CometRelay").fetchQuery(g,x,{after:a,first:w,scale:d("WebPixelRatio").get(),threadID:c}).toPromise().then(function(a){var b;if(!F.current)return;a=a==null?void 0:(a=a.message_thread)==null?void 0:a.messages_with_attachments;b=d("MWChatMediaData").normalizeMessages((b=a==null?void 0:a.edges)!=null?b:[]);if(b.length>0){E({hasNextPage:(a=a==null?void 0:(a=a.page_info)==null?void 0:a.has_next_page)!=null?a:!1,medias:b,type:"nextPageReceived"})}})["catch"](function(a){if(!F.current)return;t(a)})},[g,F,i]);q(function(){A!=null&&(c("promiseDone")(J(A)),c("promiseDone")(I(A)))},[g,J,I,A,i.thread_id]);var K=(u=(m=D[0])==null?void 0:m.cursor)!=null?u:null,L=(m=(f=D[D.length-1])==null?void 0:f.cursor)!=null?m:null;q(function(){v<=w/2&&z&&!C&&K!=null?c("promiseDone")(I(K)):v>=D.length-w/2&&y&&!B&&L!=null&&c("promiseDone")(J(L))},[v,I,J,y,z,K,L,D.length,B,C]);u=D[v-1];f=D[v+1];var M=null,N=null;u!=null&&u.__typename==="MessageImage"&&(M=u.attachment.image.uri);f!=null&&f.__typename==="MessageImage"&&(N=f.attachment.image.uri);q(function(){d("MWChatMediaUtil").prefetchImages([M,N])},[M,N]);m=D[v];u=typeof i.thread_id==="string"?(l||(l=d("I64"))).of_string(i.thread_id):null;f=d("MWLSThread").useThread(u,function(a){return d("LSMessagingThreadTypeUtil").isDiscoverablePublicBroadcastChannel(a.threadType)});if(c("gkx")("2183")&&((u=G==null?void 0:(u=G.message_thread)==null?void 0:(u=u.messages_with_attachments)==null?void 0:(u=u.edges)==null?void 0:u.length)!=null?u:0)<1)return n.jsx(c("CometContentNotAvailable.react"),{});if(A==null)return null;if(m==null)return n.jsx(c("CometContentNotAvailable.react"),{});u=D.map(function(a){var b=a.attachment.imageThumb,c=b.height,d=b.uri;b=b.width;return{alt:h._("__JHASH__SUN00vbyQRp__JHASH__"),height:c,key:(c=a.attachment.legacyAttachmentID)!=null?c:d,uri:d,width:b}}).filter(Boolean);return n.jsx(c("MWChatMediaViewerStage.react"),{activeIndex:v,attachmentID:m.attachment.legacyAttachmentID,backgroundSrc:m.__typename!=="MessageAnimatedImage"?m.attachment.imageThumb.uri:void 0,disableNextButton:B&&D[v+1]==null,disablePrevButton:C&&D[v-1]==null,downloadLink:m.__typename==="MessageVideo"?(e=m.attachment.hdUrl)!=null?e:m.attachment.sdUrl:m.attachment.image.downloadableUri,hideNextButton:!y&&D[v+1]==null,hidePrevButton:!z&&D[v-1]==null,isForwardEnabledForThread:a!=="COMMUNITY"&&a!=="E2EE_CUTOVER"&&!f,messageID:typeof i.thread_id==="string"&&m.timestamp!=null?d("MWChatMessageId").makeSent(i.thread_id,m.messageID,m.timestamp):null,setActiveIndex:function(a){return E({curIdx:a,type:"viewMediaAtIndex"})},showMessengerLink:j,thumbnails:u,children:m.__typename==="MessageVideo"?n.jsx(c("MWChatMediaViewerVideo.react"),{fbid:m.nodeID,hdSrc:m.attachment.hdUrl!=null?m.attachment.hdUrl:void 0,originalHeight:m.attachment.originalDimensions.x,originalWidth:m.attachment.originalDimensions.y,sdSrc:m.attachment.sdUrl}):m.__typename==="MessageImage"?n.jsx(c("MWChatMediaViewerImage.react"),{blurredImageURI:m.attachment.blurredImageUri,imageURI:m.attachment.image.uri}):m.__typename==="MessageAnimatedImage"?n.jsx(c("MWChatMediaViewerImage.react"),{blurredImageURI:null,imageURI:m.attachment.image.uri,origHeight:m.attachment.image.height,origWidth:m.attachment.image.width}):null})}y.displayName=y.name+" [from "+f.id+"]";function a(a){var b=t(4),e=d("CometRouteParams").useRouteParams();a.props.manualRouteParams!=null&&(e=a.props.manualRouteParams);var f=String(e.thread_id),g=String(e.attachment_id);e=String(e.message_id);g=A(g,e,f);if(c("gkx")("1775")&&g!=null)e=g;else{b[0]!==a?(f=n.jsx(y,babelHelpers["extends"]({},a)),b[0]=a,b[1]=f):f=b[1];e=f}b[2]!==e?(g=n.jsx(c("CometErrorBoundary.react"),{fallback:z,children:e}),b[2]=e,b[3]=g):g=b[3];return g}function z(){return n.jsx(c("CometErrorRoot.react"),{})}z.displayName=z.name+" [from "+f.id+"]";function A(a,b,c){var e=t(11),f;e[0]!==c?(f=(l||(l=d("I64"))).of_string(c),e[0]=c,e[1]=f):f=e[1];c=f;f=d("MAWThreadCutover").useGetCutoverOpenThreadKey(c);var g=d("MAWThreadCutover").useCutoverSecureThreadKeyForOpenThreadKey(f==null?c:void 0);c=d("MWLSThread").useThread(c);b=B(b,a);if(b==null||c==null)return null;if(f==null&&g==null)return null;a=f!=null?f:c.threadKey;f=g!=null?g:c.threadKey;e[2]!==b||e[3]!==c?(g=n.jsx(v,{initialAttachment:b,thread:c}),e[2]=b,e[3]=c,e[4]=g):g=e[4];var h;e[5]!==b||e[6]!==a||e[7]!==f||e[8]!==c.threadType||e[9]!==g?(h=n.jsx(u,{initialAttachment:b,openThreadKey:a,secureThreadKey:f,threadType:c.threadType,children:g}),e[5]=b,e[6]=a,e[7]=f,e[8]=c.threadType,e[9]=g,e[10]=h):h=e[10];return h}function B(a,b){var e=t(5),g=(j||(j=c("useReStore")))(),h,i;e[0]!==g.tables.attachments||e[1]!==a||e[2]!==b?(h=function(){return d("ReQL").fromTableAscending(g.tables.attachments).filter(function(c){return c.messageId===a&&c.attachmentFbid===b})},i=[g.tables.attachments,a,b],e[0]=g.tables.attachments,e[1]=a,e[2]=b,e[3]=h,e[4]=i):(h=e[3],i=e[4]);return d("ReQLSuspense").useFirst(h,i,f.id+":611")}g["default"]=a}),226);